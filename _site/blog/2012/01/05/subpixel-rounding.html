<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
	<link rel="alternate" type="application/rss+xml" title="Tyler Tate. Founder, designer, author, woodchopper." href="http://feeds.feedburner.com/TylerTate" />
	<title>Tyler Tate. Coping with Sub-pixel Rounding in IE</title>

	<script type="text/javascript" src="//use.typekit.net/lef3yon.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

	<link rel="stylesheet" href="http://localhost:4000//resources/css/main.css" type="text/css">
	<!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-761992-5']);
		_gaq.push(['_trackPageview']);

		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
</head>

<body id="blog">

	<header class="site-header">
		<nav class="site-nav">
			<ul>
				<!--li class="site-nav-item">
					<a class="icon-building" href="http://twigkit.com/" title="My Company: Twigkit"><span>Company</span></a>
				</li-->
				<li class="site-nav-item">
					<a class="icon-book-open" href="http://designingthesearchexperience.com/" title="My Book: Designing the Search Experience"><span>Book</span></a>
				</li>
				<li class="site-nav-item">
					<a class="icon-linkedin-squared" href="http://uk.linkedin.com/in/tylertate/" title="My LinkedIn Profile"><span>LinkedIn</span></a>
				</li>
				<li class="site-nav-item">
					<a class="icon-twitter" href="http://twitter.com/tylertate" title="Follow me on Twitter"><span>Twitter</span></a>
				</li>
			</ul>
		</nav>
		<figure class="my-photo">
			<a href="/">
				<img src="/resources/images/tyler-tate.jpg" />
			</a>
		</figure>
		<figure class="my-name">
			<a href="/">Tyler Tate</a>
		</figure>
	</header>

	<article class="post">

	<header class="post-header">
		<p class="post-date">Jan 05, 2012</p>
		<h1 class="post-title">Coping with Sub-pixel Rounding in IE</h1>
	</header>

	<section class="post-content">
		<p>An old, ugly problem still plagues fluid layouts: sub-pixel rounding. You’ve experienced this nasty issue when elements within your percentage-based layout unexpectedly wrap to the next line in Internet Explorer, or aren’t flush with the right-hand edge in Safari and Chrome.</p>

<p>The culprit? How percentages are rounded into pixel values by the browser. As <a href="http://ejohn.org/blog/sub-pixel-problems-in-css/">John Resig documented</a> in 2008, browsers have adopted different rounding strategies:</p>

<blockquote>
  <p>Webkit and Opera always round down, FireFox and Internet Explorer 8 and 9 round some numbers up, others down, and IE6 &amp; IE7 always round up.</p>
</blockquote>

<p>Below is the output of this <a href="http://tylertate.github.com/subpixel-rounding/examples/four/four.html">example page</a> in the major browsers. I’ve extended John Resig’s original demonstration by testing 4 columns, each 25% wide, within three differently sized containers: 49px, 50px, and 51px. The number shown below each container is the theoretical pixel width of one of the columns (e.g. 50px * .25 = 12.5).</p>

<p><img src="http://tylertate.com/resources/images/2012-01-05/browser-subpixel-rounding.png" width="620" style="width: 100%; max-width: 620px;" alt="The sub-pixel rounding problem" /></p>

<p>You’ll notice that in Webkit and Opera, which use the rounding-down strategy, there is space leftover. FireFox, IE8, and IE9, on other hand, vary the widths of the boxes so that, in total, they occupy all of the available space. <strong>But here’s the catch:</strong> when the floating decimal is .5 or greater, our old friends IE6 and 7 stupidly <strong>round up</strong>, forcing the final column in our example to wrap to the next line since the four columns become collectively wider than their parent container. Facepalm.</p>

<p>This is certainly not a new problem; it’s been the source of head-to-wall bashing for over a decade. Yet it’s an important problem to understand and address in the modern era of fluid, responsive layouts. While it’s true that the problem will mostly go away when IE6 and 7 support is no longer necessary, many of us need a solution now.</p>

<h2 id="the-formula">The formula</h2>
<p>Unfortunately, there’s no silver bullet.</p>

<blockquote>
  <p>The only way to prevent layouts from breaking in IE6/7 is to fractionally reduce the percentages so that they add up to just under 100%.</p>
</blockquote>

<p>In the past this has meant fiddling down the numbers until the elements stop wrapping, an inexact and error-prone art. There is, however, an exact science to it.</p>

<p>The objective is simply to get IE to round numbers down, not up. In the example above, we want 12.5px, 12.75px, or even 12.99px, to be rounded down to 12px, just like it would be in WebKit. The solution is straightforward in principle: just subtract half a pixel. 12.99px would then become 12.49px, and—since the floating decimal is less than .5—IE would round down to the nearest integer.</p>

<p>But the tricky bit is getting from pixels back to percentages. What percentage do we need to subtract in order to produce a half-pixel reduction in the computed pixel value? The answer: <strong>it depends on the pixel width of the parent container</strong>. Here’s the formula:</p>

<pre><code>O.5 / containerWidth = correctionLevel
</code></pre>

<p><code>ContainerWidth</code> is the pixel width of the container, while <code>correctionLevel</code> represents the percentage that needs to be subtracted in order for IE to round down to the nearest pixel. Thus for our 50px container above, the <code>correctionLevel</code> is <code>0.5 / 50 = 0.01</code>, or 1%. That means instead of the four columns each being 25%, they would need to be 24% (25 - 1). With that corretion applied, the columns would each be computed as 12px rather than 12.5px, and our layout will display correctly, as shown below.</p>

<p><img src="http://tylertate.com/resources/images/2012-01-05/browser-subpixel-rounding-corrected.png" width="620" style="width: 100%; max-width: 620px;" alt="Sub-pixel rounding with the correction formula applied" /></p>

<p>But the whole point of using percentages, I hear you saying, is to be pixel-independent. If I have to specify the container’s pixel width, doesn’t that defeat the purpose of using percentages in the first place? It’s painfully inconvenient, to be sure, but the very fact that you’re reading this is evidence enough that we must work around this problem somehow.</p>

<p>Here are two strategies for applying this correction formula.</p>

<h2 id="do-it-yourself-calculations">Do-it-yourself calculations</h2>
<p>You can quickly apply the above formula to your existing fluid layouts to fix the sub-pixel rounding issue in IE6 and 7 without adversely affecting other browsers. First, lets assume you have constructed a percentage-based layout that has a set minimum width of <strong>720px</strong>. Using this number as our baseline <code>containerWidth</code>, our formula tells us that the correctionLevel is <strong>.0694%</strong>. Whenever a percentage is used as the value of a width, padding, border, or margin declaration, we’ll use the star hack to add IE6/7-specific declarations which subtract .0694% from the original value. Here’s a simplistic example:</p>

<pre><code>section#sidebar {
  width: 25%;
  *width: 24.93%;
}
</code></pre>

<h2 id="css-frameworks">CSS frameworks</h2>
<p>If you’re using a CSS framework such as <a href="http://lesscss.org/">LESS.js</a> or <a href="http://sass-lang.com">SaSS</a>, you can rely on their mathematic operations to save you from having to crunching all the numbers by hand. The LESS/SaSS code below would be compiled to the same output as in the example above.</p>

<pre><code>section#sidebar {
  width: 25%;
  *width: 25%-0.0694%;
}
</code></pre>

<p><em>Updated January 11, 2012.</em> The newly-released version 1.2 of <a href="http://Semantic.gs">The Semantic Grid System</a>—which uses the power of CSS frameworks to elegantly power fixed, fluid, and responsive layouts—incorporates the above formula. It allows you to specify the minimum width of your layout, from which it then derives the correction level.</p>

<pre><code>@min-width: 960;
@correction: 0.5 / @min-width * 100 * 1%;
</code></pre>

<p>It then subtracts the correction level from the IE-specific width and margin declarations of each column in the layout:</p>

<pre><code>width: @computedWidth;
margin: 0 @computedMargin;

*width: @computedWidth-@correction;
*margin: 0 @computedMargin-@correction;
</code></pre>

<h2 id="the-last-word">The last word</h2>
<p>So there you have it: a predictable formula for correcting the sub-pixel rounding problem in Internet Explorer 6 and 7. It’s just one more reason we can all rejoice when IE6 and 7 go the way of the grave.</p>


		<div id="disqus_thread"></div>
		<script type="text/javascript">
		    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		    var disqus_shortname = 'tylertate'; // required: replace example with your forum shortname

		    // The following are highly recommended additional parameters. Remove the slashes in front to use.
		    var disqus_identifier = '/blog/2012/01/05/subpixel-rounding.html';
		    var disqus_url = 'http://www.tylertate.com/blog/2012/01/05/subpixel-rounding.html';

		    /* * * DON'T EDIT BELOW THIS LINE * * */
		    (function() {
		        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		    })();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
		
	</section>
	
</article>

</body>
</html>